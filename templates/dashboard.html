{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="challenge-header">
        <h2>Day {{ current_day }} of 75</h2>
        {% if current_day > 0 and current_day <= 75 %}
            <p class="challenge-date">Challenge started: {{ challenge.start_date.strftime('%B %d, %Y') }}</p>
        {% elif current_day == 0 %}
            <p class="challenge-date">Challenge starts: {{ challenge.start_date.strftime('%B %d, %Y') }}</p>
        {% else %}
            <p class="challenge-date">🎉 Challenge Complete! 🎉</p>
        {% endif %}
    </div>

    <!-- Day Navigation -->
    <div class="day-navigation">
        <a href="{{ url_for('dashboard', day=selected_day - 1) }}"
           class="btn btn-nav {% if selected_day <= 1 %}disabled{% endif %}">
            ← Previous
        </a>
        <div class="day-selector">
            <label for="day-select">Viewing Day:</label>
            <select id="day-select" onchange="window.location.href='/dashboard/' + this.value">
                {% for d in range(1, 76) %}
                    <option value="{{ d }}" {% if d == selected_day %}selected{% endif %}>
                        Day {{ d }}{% if d == current_day %} (Today){% endif %}
                    </option>
                {% endfor %}
            </select>
        </div>
        <a href="{{ url_for('dashboard', day=selected_day + 1) }}"
           class="btn btn-nav {% if selected_day >= 75 %}disabled{% endif %}">
            Next →
        </a>
    </div>

    <div class="progress-section">
        <h3>Your Progress</h3>
        <div class="progress-bar-container">
            <div class="progress-bar" style="width: {{ progress_percentage }}%"></div>
        </div>
        <p class="progress-text">
            {{ completed_count }} of {{ total_possible }} goals completed ({{ "%.1f"|format(progress_percentage) }}%)
        </p>
        
        {% if progress_percentage >= 100 %}
            <div class="motivational-message success">
                🏆 Perfect score! You're absolutely crushing it! Keep this momentum going!
            </div>
        {% elif progress_percentage >= 75 %}
            <div class="motivational-message great">
                🌟 Excellent work! You're in the top tier - stay focused!
            </div>
        {% elif progress_percentage >= 50 %}
            <div class="motivational-message good">
                💪 Great effort! You're over halfway there - keep pushing!
            </div>
        {% elif progress_percentage >= 25 %}
            <div class="motivational-message okay">
                🔥 You're building momentum! Every day counts - let's go!
            </div>
        {% else %}
            <div class="motivational-message start">
                🚀 The journey begins now! You've got this - one day at a time!
            </div>
        {% endif %}
    </div>

    {% if selected_day > 0 and selected_day <= 75 %}
    <div class="daily-goals">
        <h3>{% if selected_day == current_day %}Today's Goals{% else %}Day {{ selected_day }} Goals{% endif %}</h3>
        {% if selected_day != current_day %}
            <p class="day-info">Editing historical day - changes are saved automatically</p>
        {% endif %}
        <form class="goals-checklist">
            {% for goal in goals %}
            <div class="goal-item">
                <label>
                    <input type="checkbox"
                           hx-post="/progress/toggle/{{ goal.id }}/{{ selected_day }}"
                           hx-target="this"
                           hx-swap="outerHTML"
                           {% if day_progress.get(goal.id) %}checked{% endif %}>
                    <span class="goal-text">{{ goal.goal_text }}</span>
                </label>
            </div>
            {% endfor %}
        </form>
    </div>
    {% elif current_day == 0 %}
    <div class="waiting-message">
        <h3>Get Ready!</h3>
        <p>The challenge hasn't started yet. Come back on {{ challenge.start_date.strftime('%B %d, %Y') }} to begin!</p>
        <p>Use this time to prepare and set your goals.</p>
    </div>
    {% else %}
    <div class="completion-message">
        <h3>🎉 Congratulations! 🎉</h3>
        <p>You've completed the 75 Hard Challenge!</p>
        <p>Your dedication and perseverance are truly inspiring!</p>
    </div>
    {% endif %}

    <div class="quick-links">
        <a href="{{ url_for('scoreboard') }}" class="btn btn-secondary">View Scoreboard</a>
        <a href="{{ url_for('manage_goals') }}" class="btn btn-secondary">Edit Goals</a>
    </div>
</div>
{% endblock %}
